# 프로세스와 스레드의 개념
## 프로세스(Process)
### 개념
- 운영체제로부터 자원을 할당받은 *작업의 단위*
- 정적인 프로그램이 동적으로 변하여 프로그램이 돌아가고 있는 상태
	- 즉, 컴퓨터에서 작업 중인 프로그램을 의미하는 것
- 메모리 공간을 할당해 줘야 실행 가능
### 프로그램 vs 프로세스

| 프로그램                                  | 프로세스                                    |
| ------------------------------------- | --------------------------------------- |
| 어떤 작업을 하기 위해 실행할 수 있는 파일              | 실행되어 작업중인 컴퓨터 프로그램                      |
| 파일이 저장 장치에 있지만 메모리에는 올라가 있지 않은 정적인 상태 | 메모리에 적재되고 CPU 자원을 할당받아 프로그램이 실행되고 있는 상태 |
| 쉽게 말해 그냥 코드 덩어리                       | 그 코드 덩어리를 실행한 것                         |
### 메모리
- 프로세스의 자원 구조
![img](../../img/240714_1.PNG)
1. 코드 영역 (Code / Text) : 프로그래머가 작성한 프로그램 함수들의 코드가 CPU가 해석 가능한 기계어 형태로 저장
2. 데이터 영역 (Data) : 코드가 실행되면서 사용하는 전역 변수나 각종 데이터들이 모여있다. 
   - .data : 전역 변수 또는 static 변수 등 프로그램이 사용하는 데이터를 저장
   - .BSS : 초기값 없는 전역 변수, static 변수가 저장
   - .rodata : const 같은 상수 키워드 선언 된 변수나 문자열 상수가 저장
3. 스택 영역 (Stack) : 지역 변수와 같은 호출한 함수가 종료되면 되돌아올 임시적인 자료를 저장하는 독립적인 공간. Stack은 함수의 호출과 함께 할당되며, 함수의 호출이 완료되면 소멸. 만일 stack 영역을 초과하면 stack overflow 에러 발생
4. 힙 영역 (Heap) : 생성자, 인스턴스와 같은 동적으로 할당되는 데이터들을 위해 존재하는 공간. 사용자에 의해 메모리 공간이 동적으로 할당되고 해제
- [!] 스택과 힙 영역은 *크기가 가변인 동적 영역*
### 자원 공유
- 기본적으로 각 프로세스는 메모리에 별도의 주소 공간에서 실행되기 때문에, 한 프로세스는 다른 프로세스의 변수나 자료구조에 접근 불가능
1.  IPC(Inter-Process Communication) 사용
2. LPC(Local inter-Process Communication) 사용
3. 별도로 공유 메모리를 만들어서 정보를 주고받도록 설정
- 프로세스 자원공유는 단순히 CPU 레지스터 교체뿐만이 아니라 RAM과 CPU 사이의 캐시 메모리까지 초기화되기 때문에 *자원 부담이 크다는 단점이 있음. 다중 작업이 필요한 경우 스레드를 이용하는 것이 훨씬 효율적*이라, 현대 컴퓨터의 운영체제에선 다중 프로세싱을 지원하고 있지만 다중 스레딩을 기본으로 하고 있다.
## 스레드 (Thread)
- 프로세스가 할당받은 자원을 이용하는 *실횅 흐름의 단위*
### 프로세스의 한계
- 과거에는 프로그램을 실행할 때 프로세스 하나만을 사용함
	- 하지만 프로그램이 복잡해지고 다채로워짐으로써 프로세스 작업 하나만을 사용해서 실행하기에는 한계가 발생
- 스레드는 이런 한계 해결을 위해 탄생함
### 개념
- 프로세스 내에서 동시에 진행되는 작업 갈래, 흐름의 단위
- 하나의 프로세스 내에 여러가지 작업 흐름이 동시에 진행됨
	- 멀티(다중) 스레드라고도 부름
- 스레드 수가 많을 수록 프로그램 속도, 성능 올라감 (동시에 하는일이 많아지기 때문)
### 자원 공유
- 프로세스가 할당 받은 자원을 이용하는 실행의 단위, 스레드가 여러개 있으면 우리가 파일을 다운받으며 동시에 웹 서핑 가능하게 해줌
- 스레드끼리 프로세스의 자원을 공유하며 프로세스 실행 흐름의 일부가 되기 때문에 동시 작업이 가능함
	- 따라서 하나의 프로세스 내에 여러개의 스레드가 들어있음
- 스레드는 Stack만 할당받아 복사하고 Code, Data, Heap은 프로세스 내의 다른 스레드들과 *공유됨*
	- stack은 함수 호출 시 전달되는 인자, 되돌아갈 주소 값, 함수 내에서 선언하는 변수 등을 저장하는 메모리 공간이기 때문에, 독립적인 스택을 가졌다는 것은 독립적인 함수 호출이 가능하다 라는 의미
	- 독립적인 함수 호출이 가능하다는 것은 독립적인 실행 흐름이 추가된다는 ㅏㅁㄹ
		- *stack을 가짐으로써 스레드는 독립적인 실행 흐름을 가질 수 있게 됨*
![img](../../img/240716_01.PNG)
- 각각의 스레드는 별도의 stack을 가지고있지만 Heap 메모리는 고유하기 때문에 서로 다른 스레드에서 가져와 읽고 쓸 수 있게 됨
![img](../../img/240716_02.PNG)
- 반면에 프로세스는 기본적으로 프로세스끼리 다른 프로세스의 메모리에 직접 접근할 수 없음
	- 하나의 프로세스를 다수의 실행 단위인 스레드로 구분하여 자원을 공유하고, 자원의 생성과 관리의 중복성을 최소화하여 수행 능력을 올리기 위함
# 프로세스 상태와 PCB
## 프로세스 상태
| 상태              | 설명                                                                   |
| --------------- | -------------------------------------------------------------------- |
| 생성 (create)     | 프로세스의 생성                                                             |
| 실행 (running)    | 프로세스가 CPU를 차지하여 명령어들 실행                                              |
| 준비 (ready)      | 프로세스가 CPU를 사용하고 있지는 않짐나 언제든지 사용할 수 있는 상태<br>우선순위가 높은 프로세스 순으로 CPU 할당 |
| 대기 (waiting)    | 보류(block)라고도 부름. 입출력 완료, 시그널 수신 등 어떤 사건을 기다리고 있는 상                   |
| 종료 (terminated) | 프로세스의 실행 종료                                                          |
### 프로세스의 상태 변화
- 시스템에서 준비, 실행, 대기 상태로 바뀌면서 실행&종료
- 운영체제가 작업 스케줄러와 프로세스 스케줄러 같은 프로세서 스케줄러를 이용해 관리
![img](../../img/240716_03.PNG)
- 실행 상태
	- 프로세서가 자발적으로 반환하기 전에 할당된 시간이 지나면 준비 상태가 됨
	- 입출력 명령이나 특정 이벤트 발생 시 대기 상태
- 대기 상태
	- 대기 원인을 제거하면 준비 상태로 바뀜
	- 디스패처가 준비 상태인 프로세스를 프로세서에 할당하면 다시 실행 상태로 바뀜
#### 1. 준비 → 실행 (Dispatch)
- 디스패치: 준비 큐 맨 앞에 있는 프로세스가 프로세스를 점유하는 것
- 다중 프로그래밍 운영체제는 실행 상태인 프로세스가 할당된 시간만큼만 프로세스를 사용하여 특정 프로세스의 독점 방지
#### 2. 실행 → 준비 (Timeout)
- 운영체제는 프로세스의 독점 방지를 위해 인터럽트 클록(interrupt clock)을 두어 일정 시간만 점유하도록 제한
- 시간이 지나도 프로세서를 반환하지 않으면 클록이 인터럽트를 발생시켜 운영체제에 프로세서 제어권을 부여
#### 3. 실행 → 대기 (Block)
- 할당된 시간 이전에 실행 상태의 프로세스에 입출력 연산 또는 자원 요청 등의 문제로 프로세서를 스스로 넘기는 경우
#### 4. 대기 → 준비 (Wakeup)
- 입출력 작업이 끝나거나 문제가 해결된다면 대기 상태에서 준비 상태가 됨
## PCB(Process Control Block)
: 특정한 프로세스를 관리할 필요가 있는 정보를 포함하는 운영체제 커널의 자료구조
- Context Switching 시 사용됨
- CPU가 여러 프로세스를 빠르게 번갈아가며 작업하기 위해서는 프로세스에 대한 정보 및 상태를 저장/복원할 필요가 있기 때문
### PCB에 저장되는 정보
| 정보                   | 설명                                                                                                                                   |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| 프로세스 식별자             | 각 프로세스의 고유 식별자(숫자, 색인 항목)                                                                                                            |
| 프로세스 상태              | 생성, 준비, 실행, 대기, 중단 등 상태 표시                                                                                                           |
| 프로그램 카운터             | 프로세스 실행하는 다음 명령의 주소 표시                                                                                                               |
| 레지스터 저장 영역           | 프로세스를 실행하는 다음 명령의 주소 표시 누산기, 인덱스 레지스터, 스택 포인터, 범용 레지스터, 조건 코드 등 정보로 컴퓨터 구조에 따라 수나 형태 차이, 인터럽트가 발생하면 프로그램 카운터와 함께 저장하여 재실행할 때 원래대로 복귀 |
| 프로세서 스케줄링 정보         | 프로세스의 우선순위, 스케줄링 큐의 포인터, 기타 스케줄 매개변수                                                                                                 |
| 계정 정보                | 프로세서 사용 시간, 실제 사용 시간, 사용 상한 시간, 계정 번호, 작업이나 프로세스 번호 등                                                                                |
| 입출력 상태 정보, 메모리 관리 정보 | 특별한 입출력 요구 프로세스에 할당된 입출력장치<br>열린 파일 리스트 등, 운영 체제가 사용하는 메모리 시스템에 따른 상한, 하한 레지스터 (경계 레지스터), 페이지 테이블이나 세그먼트 테이블 값 등                     |

# 문맥 교환과 스케줄링
## Context Switching (문맥 교환)
: CPU에서 여러 프로세스를 돌아가면서 작업을 처리하는 과정
- 동작 중인 프로세스가 대기하면서 해당 프로세스의 상태(Context)를 PCB(Process Control Block)에 보관하고, 대기하고 있던 다음 순서의 프로세스가 동작하며 이전에 PCB에 보관했던 프로세스의 상태를 복구하는 작업
![img](../../img/240716_04.PNG)
## 프로세스 스케줄링
: 운영체제에서 CPU를 사용할 수 있는 프로세스를 선택하고, CPU를 할당하는 작업을 말함
- 프로세스 스케줄링은 프로세스 우선순위, 작업량 등을 고려하여 효율적으로 배치하여 이를 통해 운영체제는 CPU를 효율적으로 사용하며 시스템 전반적인 성능을 향상시킴
- 스래서 스케줄링은 멀티태스킹 작업을 만들어내는 데에 있어서 핵심적인 부분