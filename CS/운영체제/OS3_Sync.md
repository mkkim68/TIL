# 동기화 & 비동기화와 메모리 관리 
## 동기화와 비동기화의 개념
### 동기화
- 특정 자원에 접근할 때 한 개의 프로세스만 접근하게 하거나 프로세스를 올바른 순서대로 실행하게 하는 것
#### 프로세스 동기화
- 프로세스들 사이의 수행시기를 맞추는 것
	- 실행 순서 제어: 프로세스를 올바른 순서대로 실행하기
	- 상호 배제: 동시에 접근해서는 안 되는 자원에 하나의 프로세스만 접근하게 하기
- 스레드도 동기화 대상임 (실행의 흐름을 갖는 모든 것은 동기화의 대상)
#### 1. 실행 순서 제어를 위한 동기화
- Writer: Book.txt 파일에 값을 저장하는 프로세스
- Reader: Book.txt 파일에 저장된 값을 읽어들이는 프로세스
Reader와 Writer 프로세스는 무작정 아무렇게나 실행되어선 안됨. 실행 순서가 있다.
Reader 프로세스는 Book.txt 안에 값이 존재한다는 특정 조건이 만족되어야만 실행 가능 (Writer 선행해야함)
#### 2. 상호 배제를 위한 동기화
- 한 번에 하나의 프로세스만 접근해야 하는 자원에 동시 접근을 피하기 위한 동기화
## 상호 배제 (Mutex, Semaphore)
### 공유 자원 (shared resource)
- 동시에 접근해서는 안되는 자원은 공유 자원이다.
- 공유 자원은 여러 프로세스 혹은 스레드가 공유하는 자원
- 전역변수 뿐만 아니라 파일, 입출력 장치, 보조기억장치가 공유자원이 될 수 있음
### 임계 구역 (critical section)
- 동시에 실행하면 문제가 발생하는 자원에 접근하는 코드 영역을 임계구역이라고 함
- 임계 구역에 진입하고자 하면 진입한 프로세스 이외에는 대기해야 함
### 레이스 컨디션 (race condition)
- 입계 구역에 동시에 접근하면 자원의 일관성이 깨질 수 있음
### 상호 배제의 개념
- 하나의 프로세스만 임계 구역을 사용할 수 있도록 다른 프로세스의 접근 차단
- 4가지의 요구조건이 충족되어야 함
	1. 두 개 이상의 프로세스들이 동시에 임계구역에 있으면 안 됨
	2. 어떤 프로세스도 임계구역에 진입하는 것이 무한정 연기되면 안 됨
	3. 임계구역 안에 있는 프로세스가 다른 프로세스의 임계구역 진입을 막을 수 있어야 함
	4. 프로세스들의 상대적인 속도(각 프로세스들의 처리 속도, 접근 방법, 상태)에 대해 어떠한 가정을 하면 안됨
### 상호배제 알고리즘
#### 1. 잠금
- 하나의 프로세스가 임계구역을 점유한 후, 다른 프로세스가 접근할 수 없도록 잠그는 것
#### 2. 인터럽트 봉쇄
- 임계구역이 사용 중일 때 모든 인터럽트가 발생하지 않도록 하여 새로운 프로세스의 생성 및 접근을 막는 것
#### 3. 엄격한 교대
- 두 개의 프로세스가 하나의 임계구역을 사용할 수 있을 때 서로 교대로 접근할 수 있도록 하는 것
- 하나의 프로세스가 연속으로 접근할 수 없으며, 반드시 상대 프로세스가 사용하고 난 뒤에 접근할 수 있도록 하는 것
#### 4. 상호배제 알고리즘의 한계
- 현재 사용 중인 프로세스의 실행시간이 길다면 다른 프로세스는 임계구역을 사용하기 위해 계속해서 대기하게 된다 (Busy Wait)
- 바쁜 대기 현상이 증가하면 운영체제는 부담을 갖게 되어 컴퓨터 시스템의 전체 성능이 떨어지게 되는데, 이 현상을 제거하기 위해 세마포어 알고리즘 사용
### 세마포어 (Semaphore)
#### 개념
- 임계구역을 지키기 위한 기존 상호배제 알고리즘이 바쁜 대기 현상을 야기하는 것을 방지하고자 개발된 알고리즘
- 프로세스가 이러한 바쁜 대기 현상을 방지하기 위해 잠시 재우고 (Sleep, Wait, P연산) 나중에 깨워주는 (Wakeup, Signal, V연산) 방식 사용
- 세마포어 알고리즘에서 사용되는 공유 자원의 수를 나타내는 변수를 세마포어 변수(S)라고 함
#### 특징
- 세마포어에 대한 연산은 소프트웨어 및 하드웨어로 구현되며 연산 처리 중에 인터럽트되어서는 안됨
- 이진 세마포어는 0과 1의 값을 가지고, 산술 세마포어는 0과 자연수를 가질 수 있다.
- 프로세스 사이의 동기를 유지(동기화)하게 한다.
#### 모니터 (Monitor)
- 세마포어 알고리즘을 구현한 프로그램
- 모니터는 프로세스들이 사용할 수 있는 공유 자원 혹은 공유 자원 그룹을 할당하는 데 사용
- 데이터 및 프로시저를 포함하는 병행성 구조 (Concurrent Construct)
- 모니터 외부의 프로세스는 모니터 내부의 데이터를 직접 접근할 수 없다
- 캡슐화 개념을 사용하며 스위치 개념이 적용되어 한 번에 하나의 프로세스만 모니터에 진입(Entry)할 수 있다.
## 교착 상태 (Deadlock)
- 프로세스가 자원을 얻지 못해 다음 처리를 하지 못하는 상태로, 시스템적으로 한정된 자원을 여러 곳에서 사용하려고 할 때 발생
### 발생되는 상황 예시
- 멀티 프로그래밍 환경에서 한정된 자원을 사용하려고 서로 경쟁하는 상황 발생
- 어떤 프로세스가 자원을 요청했을 떄, 그 시각에 그 자원을 사용할 수 없는 상황이 발생할 수 있고, 그 때는 프로세스가 대기 상태로 들어감
- 대기 상태로 들어간 프로세스들이 실행 상태로 변경 될 수 없을 떄 교착 상태 발생
### 발생 조건 4가지
#### 1. 상호 배제(Mutual Exclusion)
- 자원은 한 번에 한 프로세스만이 사용할 수 있어야 한다
#### 2. 점유 대기(Hold and Wait)
- 최소한 하나의 자원을 점유하고 있으면서 다른 프로세스에 할당되어 사용되고 있는 자원을 추가로 점유하기 위해 대기하는 프로세스가 있어야 한다. 즉, 이미 자원을 사용중인데, 다른 프로세스가 사용중인 자원을 사용하기 위해 대기하고 있는 상태의 프로세스가 존재해야 함
#### 3. 비선점(No preemption)
- 다른 프로세스에 할당된 자원은 사용이 끝날 때까지 강제로 뺴앗을 수 없어야 한다.
#### 4. 순환 대기(Circular wait)
- 프로세스의 집합에서 P0은 P1이 점유한 자원을 대기하고 P1은 P2가 점유한 자원을 대기하고, P2 ... Pn-1d은 Pn이 점유한 자원을 대기하며 Pn은 P0이 점유한 자원을 요구해야 한다.